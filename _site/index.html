<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Lanyon &middot; A Jekyll theme
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A reserved <a href="http://jekyllrb.com" target="_blank">Jekyll</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    

    <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Lanyon</a>
            <small>A Jekyll theme</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="//test/2016/01/17/build-gpu-clusters/">
        Build Gpu Clusters
      </a>
    </h1>

    <span class="post-date">17 Jan 2016</span>

    <h1 id="gpu">2015 GPU折腾手记</h1>

<p>整个2015年从折腾GPU开始，到折腾GPU结束。起因是比较穷，但又想搞点“大数据”，于是15年都是在下单，拆包裹，装机器，维护中。反过来看，为了省下那一点点钱却花费了大量时间，所以想写下来经验教训供各位DIY玩家参考。</p>

<p>这里GPU机器我是指使用多块GPU用来科学计算的机器，例如针对最近火热的深度学习，另外的两个GPU主要用途——游戏，挖矿——则不在此文讨论范围。而且此文主要针对对性价比敏感的人士，对于土豪人群，推荐大厂整体GPU集群解决方案，可省去大量力气。</p>

<h2 id="gpu-1">买什么样的GPU</h2>

<p>对于科学计算而言，性能主要取决于GPU的浮点运算能力。特别是对深度学习任务来说，主要是单精度浮点运算（未来对精度的需求可能更低，例如16bit精度）。而其他因素，例如CPU速度，内存大小，通讯带宽，对目前大多数深度学习任务而言则显得没那么重要，只要过了某个合理的阈值从而不是瓶颈就行。</p>

<p>对于GPU而言，简单来看有三个重要参数，浮点运算，价格与功耗。下面两个图比较了Nvidia Tesla，Geforce 700和900系列各卡的这三个参数。前两个参考了wikipedia，后面一个是查询了amazon/newegg上的当前价格。整体来看浮点运算和价格成正比。在价格上，不考虑为土豪设计的Tesla系列的话，其余的是一分价格一分货。</p>

<p>目前的购买建议是优先考虑Titan X，但如果对于其12GB内存不是特别有兴趣的话，则考虑浮点运算性价比更好的980 TI（6GB 内存），如果嫌980 TI功耗比过高的话，则考虑980. 除非有特别的理由，个人不推荐980之下的卡了。因为达到同样的计算能力，使用更便宜的卡则会增加机器数量，可能导致其他配套成本（例如CPU，内存，电源，主板）和维护成本的增加。（下面将会有血与泪的教训）。</p>

<p>不过提醒一点是，GPU更新换代快，不宜大规模采购超出现在需求的机器。例如Nvidia下一代号称3D内存会带来新的加速，通常认为性价比更高的AMD也将会推出新的编译器来更好支持科学计算。</p>

<p>选好了GPU后变可以配套其他了。主要考虑的是供电和散热。例如一块卡可能有200w，4卡则800w了，加上CPU内存，电源至少要个1kw才行。其次GPU发热巨大，将多块GPU并排放会导致很严重的散热问题。还有，如果大量购买GPU机器，机房供电和散热也会是个大问题。</p>

<h2 id="section">个人折腾手记</h2>

<p>这里我分享一下15年折腾过的机器。背景是我们钱很少，能用来买机器的不超过5万刀。但手头有一些求来的硬件，例如Intel送了一打I5 CPU，Nvidia送了几块K40，一块Titan X，死皮要脸的问其他组要来一些淘汰的或者空闲的机器，拆了后往里面塞GPU。所以在实际花费可能不超过4万刀的情况下添置下面这些设备：</p>

<table>
  <thead>
    <tr>
      <th>CPU</th>
      <th>GPU</th>
      <th>mem</th>
      <th>网络</th>
      <th>尺寸</th>
      <th>数量</th>
      <th>单台价格</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>i5-3470</td>
      <td>2 x GTX 970</td>
      <td>1G</td>
      <td>mini tower</td>
      <td>&gt;10</td>
      <td>$1.3k</td>
      <td> </td>
    </tr>
    <tr>
      <td>?</td>
      <td>4 x K40</td>
      <td>10G</td>
      <td>4U rack</td>
      <td>1</td>
      <td>?</td>
      <td> </td>
    </tr>
    <tr>
      <td>?</td>
      <td>2 x GTX 980</td>
      <td>2 x 40G</td>
      <td>2U</td>
      <td>&gt;10</td>
      <td>?</td>
      <td> </td>
    </tr>
    <tr>
      <td>?</td>
      <td>4 x GTX 750 TI</td>
      <td>1G</td>
      <td>full tower</td>
      <td>5</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>?</td>
      <td>4 x GTX 980</td>
      <td>10G</td>
      <td>tower</td>
      <td>1</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>？</td>
      <td>4 x Titan X</td>
      <td>10G</td>
      <td>1U</td>
      <td>1</td>
      <td>10k</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>下面按购置时间顺序来逐一吐槽</p>

<h3 id="section-1">双980</h3>

<p>此集群是土豪系统组买的。配了CPU是当时最好，双40GB网络快到飞起，光交换机就花了10W刀。但买回来后半年没人拆封。我们厚脸皮的说我们帮你们装上，顺便出钱升级电源（750W-&gt;1.2KW）和买GPU，到时候共享给我们用一下就好了。下图是alex意外发现了这个未拆箱的集群，拆了一台过来看看。</p>

<p>这是我个人最爱集群，安装简单，2天全搞定。</p>

<p>网络快到飞起，很适合做分布式运算。但反过来说，CPU过于的好了，内存对于双卡来说过于大了，网络也是过于土豪，根本用不完。因为经常长时间跑大任务，我们很早的就把电源给烧了。。。</p>

<h3 id="section-2">双970</h3>

<p>情人节那天alex惊喜的掏出一板巧克力一样的东西，说“看，intel送的”。我当时就震惊了。后来发现原来是一打CPU，用冰箱里制冰块一样的板子，一个坑一块CPU。但CPU很弱，是n年前被淘汰的，所以我们准备去折腾个便宜的GPU集群。</p>

<p>下面是前三台订单，之后又陆续买了几台，然后忽悠别组老师也投资买了几台。有一整子组会都是装机大会。</p>

<p>这个集群的优点是单机便宜，十台机器差不多1W刀搞定（一个phd学生一年要花费老板10W+刀）。但由于是分多批买的，每次买都是挑当时最便宜的硬件，例如电源有4种，后来我们才发现电源接GPU线是不通用的。虽然GPU都是970，但来自4个不同的牌子，msi，evga, pny， gigabyte. 而且便宜硬件出错率也挺高，维护是个噩梦。另外一个问题是机箱占地方，大小基本等价一个4U的机器大小了，而且就插了2卡，而4U机器现在基本插8卡了。</p>

<h3 id="section-3">四卡980</h3>

<p>我最爱，也是折腾我最多的。第一个版本是长这样的，alex手艺高超的把整个机箱塞满了GPU，内存，硬盘。</p>

<p>结果发现散热是个大问题。一机箱太满，二机箱风扇不给力，三显卡风扇不给力。之后做了无数次测试，升级，期间烧坏了两快卡。这是目前的长相。机箱大了很多，前后装满了风扇，硬盘都卸了，第一块坏的卡送修了，第二块懒得动了，现在跛着脚跑。</p>

<h3 id="ti">四卡750 TI</h3>

<p>这是dave用来挖矿的机器。一开始是裸的，就是主板接电源插GPU一字排开趟在dave的地下室挖矿，顺便当地暖用。后面挖矿不赚钱了后我们要来装上了机箱来重新利用一下。因为集群是pxe启动装centos，但这些机器用的游戏主板专为windows优化，而且又是来自不同厂家。花了整整两天才摸清怎么成功pxe启动，然而还是有一台现在都起不起来。</p>

<h3 id="k40">四卡K40机器</h3>

<p>没有特别好说的，intel送了一个4U的机器，插上4快卡，半个小时搞定。但我觉得4U才插4卡，有点浪费空间。</p>

<h3 id="titan-x">四卡Titan X机器</h3>

<p>刚买没几天。起因是上个月的NIPS我找N厂哭穷，N见我长得眉清目秀（误）送了一块卡。回来献给老板，老板因为国内某大厂赞助了些钱大手一挥补齐了剩下。Supermicro 1U塞了4快卡，里面的空间是寸土必争，装完后（整整一个下午）特别治愈强迫症。</p>

<p>因为空间狭小，所以风扇功率很大，噪音跟轰炸机一样。其中并列的三卡散热还行，另一块单独的卡温度明显比别人高。但目前来看没什么大碍。就是有点耗电，全力跑电流需要10A。</p>

<h3 id="section-4">接下来？</h3>

<p>因为已经有了些打底，接下来应该不会买超性价比机器了。如果有钱的话会考虑4卡Titan X类似的配置，但也会考虑8卡的机器。</p>

<h2 id="section-5">总结</h2>

<p>折腾硬件就跟其他很多事情一样，要么有钱，要么得有时间折腾。对各位玩家的建议是，如果只是上一两台，可以在newegg上多选多看，但如果是准备买数十台，建议还是用整体方案，例如asus和supermicro都是不错的选择。happy hacking!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2014/01/02/introducing-lanyon/">
        Introducing Lanyon
      </a>
    </h1>

    <span class="post-date">02 Jan 2014</span>

    <p>Lanyon is an unassuming <a href="http://jekyllrb.com">Jekyll</a> theme that places content first by tucking away navigation in a hidden drawer. It’s based on <a href="http://getpoole.com">Poole</a>, the Jekyll butler.</p>

<h3 id="built-on-poole">Built on Poole</h3>

<p>Poole is the Jekyll Butler, serving as an upstanding and effective foundation for Jekyll themes by <a href="https://twitter.com/mdo">@mdo</a>. Poole, and every theme built on it (like Lanyon here) includes the following:</p>

<ul>
  <li>Complete Jekyll setup included (layouts, config, <a href="/404">404</a>, <a href="/atom.xml">RSS feed</a>, posts, and <a href="/about">example page</a>)</li>
  <li>Mobile friendly design and development</li>
  <li>Easily scalable text and component sizing with <code class="highlighter-rouge">rem</code> units in the CSS</li>
  <li>Support for a wide gamut of HTML elements</li>
  <li>Related posts (time-based, because Jekyll) below each post</li>
  <li>Syntax highlighting, courtesy Pygments (the Python-based code snippet highlighter)</li>
</ul>

<h3 id="lanyon-features">Lanyon features</h3>

<p>In addition to the features of Poole, Lanyon adds the following:</p>

<ul>
  <li>Toggleable sliding sidebar (built with only CSS) via <strong>☰</strong> link in top corner</li>
  <li>Sidebar includes support for textual modules and a dynamically generated navigation with active link support</li>
  <li>Two orientations for content and sidebar, default (left sidebar) and <a href="https://github.com/poole/lanyon#reverse-layout">reverse</a> (right sidebar), available via <code class="highlighter-rouge">&lt;body&gt;</code> classes</li>
  <li><a href="https://github.com/poole/lanyon#themes">Eight optional color schemes</a>, available via <code class="highlighter-rouge">&lt;body&gt;</code> classes</li>
</ul>

<p><a href="https://github.com/poole/lanyon#readme">Head to the readme</a> to learn more.</p>

<h3 id="browser-support">Browser support</h3>

<p>Lanyon is by preference a forward-thinking project. In addition to the latest versions of Chrome, Safari (mobile and desktop), and Firefox, it is only compatible with Internet Explorer 9 and above.</p>

<h3 id="download">Download</h3>

<p>Lanyon is developed on and hosted with GitHub. Head to the <a href="https://github.com/poole/lanyon">GitHub repository</a> for downloads, bug reports, and features requests.</p>

<p>Thanks!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2014/01/01/example-content/">
        Example content
      </a>
    </h1>

    <span class="post-date">01 Jan 2014</span>

    <div class="message">
  Howdy! This is an example blog post that shows several types of HTML content supported in this theme.
</div>

<p>Cum sociis natoque penatibus et magnis <a href="#">dis parturient montes</a>, nascetur ridiculus mus. <em>Aenean eu leo quam.</em> Pellentesque ornare sem lacinia quam venenatis vestibulum. Sed posuere consectetur est at lobortis. Cras mattis consectetur purus sit amet fermentum.</p>

<blockquote>
  <p>Curabitur blandit tempus porttitor. Nullam quis risus eget urna mollis ornare vel eu leo. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
</blockquote>

<p>Etiam porta <strong>sem malesuada magna</strong> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>

<h2 id="inline-html-elements">Inline HTML elements</h2>

<p>HTML defines a long list of available inline tags, a complete list of which can be found on the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element">Mozilla Developer Network</a>.</p>

<ul>
  <li><strong>To bold text</strong>, use <code class="highlighter-rouge">&lt;strong&gt;</code>.</li>
  <li><em>To italicize text</em>, use <code class="highlighter-rouge">&lt;em&gt;</code>.</li>
  <li>Abbreviations, like <abbr title="HyperText Markup Langage">HTML</abbr> should use <code class="highlighter-rouge">&lt;abbr&gt;</code>, with an optional <code class="highlighter-rouge">title</code> attribute for the full phrase.</li>
  <li>Citations, like <cite>— Mark otto</cite>, should use <code class="highlighter-rouge">&lt;cite&gt;</code>.</li>
  <li><del>Deleted</del> text should use <code class="highlighter-rouge">&lt;del&gt;</code> and <ins>inserted</ins> text should use <code class="highlighter-rouge">&lt;ins&gt;</code>.</li>
  <li>Superscript <sup>text</sup> uses <code class="highlighter-rouge">&lt;sup&gt;</code> and subscript <sub>text</sub> uses <code class="highlighter-rouge">&lt;sub&gt;</code>.</li>
</ul>

<p>Most of these elements are styled by browsers with few modifications on our part.</p>

<h2 id="heading">Heading</h2>

<p>Vivamus sagittis lacus vel augue rutrum faucibus dolor auctor. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>

<h3 id="code">Code</h3>

<p>Cum sociis natoque penatibus et magnis dis <code class="highlighter-rouge">code element</code> montes, nascetur ridiculus mus.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Example can be run directly in your JavaScript console
</span>

<span class="c1">// Create a function that takes two arguments and returns the sum of those arguments
</span>
<span class="kd">var</span> <span class="nx">adder</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"return a + b"</span><span class="p">);</span>

<span class="c1">// Call the function
</span>
<span class="nx">adder</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="c1">// &gt; 8</span></code></pre></figure>

<p>Aenean lacinia bibendum nulla sed consectetur. Etiam porta sem malesuada magna mollis euismod. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa.</p>

<h3 id="lists">Lists</h3>

<p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aenean lacinia bibendum nulla sed consectetur. Etiam porta sem malesuada magna mollis euismod. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>

<ul>
  <li>Praesent commodo cursus magna, vel scelerisque nisl consectetur et.</li>
  <li>Donec id elit non mi porta gravida at eget metus.</li>
  <li>Nulla vitae elit libero, a pharetra augue.</li>
</ul>

<p>Donec ullamcorper nulla non metus auctor fringilla. Nulla vitae elit libero, a pharetra augue.</p>

<ol>
  <li>Vestibulum id ligula porta felis euismod semper.</li>
  <li>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</li>
  <li>Maecenas sed diam eget risus varius blandit sit amet non magna.</li>
</ol>

<p>Cras mattis consectetur purus sit amet fermentum. Sed posuere consectetur est at lobortis.</p>

<dl>
  <dt>HyperText Markup Language (HTML)</dt>
  <dd>The language used to describe and define the content of a Web page</dd>

  <dt>Cascading Style Sheets (CSS)</dt>
  <dd>Used to describe the appearance of Web content</dd>

  <dt>JavaScript (JS)</dt>
  <dd>The programming language used to build advanced Web sites and applications</dd>
</dl>

<p>Integer posuere erat a ante venenatis dapibus posuere velit aliquet. Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Nullam quis risus eget urna mollis ornare vel eu leo.</p>

<h3 id="tables">Tables</h3>

<p>Aenean lacinia bibendum nulla sed consectetur. Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Upvotes</th>
      <th>Downvotes</th>
    </tr>
  </thead>
  <tfoot>
    <tr>
      <td>Totals</td>
      <td>21</td>
      <td>23</td>
    </tr>
  </tfoot>
  <tbody>
    <tr>
      <td>Alice</td>
      <td>10</td>
      <td>11</td>
    </tr>
    <tr>
      <td>Bob</td>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <td>Charlie</td>
      <td>7</td>
      <td>9</td>
    </tr>
  </tbody>
</table>

<p>Nullam id dolor id nibh ultricies vehicula ut id elit. Sed posuere consectetur est at lobortis. Nullam quis risus eget urna mollis ornare vel eu leo.</p>

<hr />

<p>Want to see something else added? <a href="https://github.com/poole/poole/issues/new">Open an issue.</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2013/12/31/whats-jekyll/">
        What's Jekyll?
      </a>
    </h1>

    <span class="post-date">31 Dec 2013</span>

    <p><a href="http://jekyllrb.com">Jekyll</a> is a static site generator, an open-source tool for creating simple yet powerful websites of all shapes and sizes. From <a href="https://github.com/mojombo/jekyll/blob/master/README.markdown">the project’s readme</a>:</p>

<blockquote>
  <p>Jekyll is a simple, blog aware, static site generator. It takes a template directory […] and spits out a complete, static website suitable for serving with Apache or your favorite web server. This is also the engine behind GitHub Pages, which you can use to host your project’s page or blog right here from GitHub.</p>
</blockquote>

<p>It’s an immensely useful tool and one we encourage you to use here with Lanyon.</p>

<p>Find out more by <a href="https://github.com/mojombo/jekyll">visiting the project on GitHub</a>.</p>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
